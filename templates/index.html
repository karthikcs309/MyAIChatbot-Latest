<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chatbot</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');

:root {
    --bg-gradient: linear-gradient(135deg, #0f172a, #1e293b);
    --glass-bg: rgba(30, 41, 59, 0.7);
    --glass-border: 1px solid rgba(255,255,255,0.1);
    --accent: #3b82f6;
    --accent-glow: #60a5fa;
    --text: #f8fafc;
    --muted: #94a3b8;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    height: 100vh;
    font-family: 'Inter', sans-serif;
    background: var(--bg-gradient);
    color: var(--text);
    display: flex;
    overflow: hidden;
}

/* ---------- Sidebar ---------- */
.sidebar {
    width: 280px;
    background: rgba(15,23,42,0.95);
    border-right: var(--glass-border);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    transition: transform 0.3s ease;
    z-index: 40;
}

.brand {
    font-size: 1.5rem;
    font-weight: 600;
}

.new-chat-btn {
    background: var(--accent);
    border: none;
    padding: 12px;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    font-weight: 600;
}

/* ---------- Main ---------- */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
}

.chat-container {
    flex: 1;
    padding: 32px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-bottom: 120px;
}

.message {
    max-width: 80%;
    padding: 16px 22px;
    border-radius: 16px;
    font-size: 0.95rem;
    line-height: 1.6;
}

.message.user {
    align-self: flex-end;
    background: var(--accent);
    color: white;
    border-bottom-right-radius: 4px;
}

.message.bot {
    align-self: flex-start;
    background: rgba(51,65,85,0.6);
    border: var(--glass-border);
    backdrop-filter: blur(10px);
    border-bottom-left-radius: 4px;
}

/* ---------- Input ---------- */
.input-wrapper {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 85%;
    max-width: 900px;
}

.input-box {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--glass-bg);
    border: var(--glass-border);
    border-radius: 18px;
    padding: 10px 16px;
    backdrop-filter: blur(16px);
}

textarea {
    flex: 1;
    resize: none;
    background: transparent;
    border: none;
    color: white;
    font-size: 1rem;
    max-height: 160px;
}
textarea:focus { outline: none; }

.send-btn {
    background: var(--accent);
    border: none;
    width: 42px;
    height: 42px;
    border-radius: 14px;
    color: white;
    cursor: pointer;
}

/* ---------- Footer ---------- */
.footer-credit {
    text-align: center;
    font-size: 0.7rem;
    color: var(--muted);
    margin-bottom: 6px;
}

/* ---------- Mobile Menu ---------- */
.mobile-menu-btn {
    display: none;
    position: fixed;
    top: 14px;
    left: 14px;
    background: var(--accent);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    font-size: 1.2rem;
    z-index: 60;
}

/* ---------- Typing ---------- */
.typing span {
    display: inline-block;
    width: 6px;
    height: 6px;
    background: #cbd5e1;
    border-radius: 50%;
    margin: 0 2px;
    animation: bounce 1.4s infinite;
}
.typing span:nth-child(2){animation-delay:0.2s}
.typing span:nth-child(3){animation-delay:0.4s}

@keyframes bounce {
    0%,80%,100%{transform:translateY(0)}
    40%{transform:translateY(-6px)}
}

/* ---------- Responsive ---------- */
@media (max-width: 768px) {
    body { flex-direction: column; }

    .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        transform: translateX(-100%);
    }
    .sidebar.active { transform: translateX(0); }

    .mobile-menu-btn { display: block; }

    .chat-container {
        padding: 16px;
        padding-bottom: 140px;
    }

    .message { max-width: 100%; }

    .input-wrapper {
        width: 94%;
        bottom: 14px;
    }
}
</style>
</head>

<body>

<button class="mobile-menu-btn" onclick="toggleSidebar()">
<i class="fas fa-bars"></i>
</button>

<div class="sidebar">
    <div class="brand"><i class="fas fa-brain"></i> AI Chatbot</div>
    <button class="new-chat-btn" onclick="clearChat()">
        <i class="fas fa-plus"></i> New Chat
    </button>
</div>

<div class="main-content">
    <div class="chat-container" id="chatBox">
        <div class="message bot">
            ✨ Hello! I’m your AI Chatbot. Ask me anything.
        </div>
    </div>

    <div class="input-wrapper">
        <div class="input-box">
            <textarea id="userInput" rows="1"
            placeholder="Ask AI Chatbot..."
            oninput="this.style.height='';this.style.height=this.scrollHeight+'px'"
            onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage();}">
            </textarea>
            <button class="send-btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <div class="footer-credit">Made by Karthik C S</div>
</div>

<script>
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');

function toggleSidebar(){
    document.querySelector('.sidebar').classList.toggle('active');
}

function appendMessage(text, sender){
    const div = document.createElement('div');
    div.className = `message ${sender}`;
    div.innerHTML = marked.parse(text);
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function appendLoading(){
    const id = 'loader-'+Date.now();
    const div = document.createElement('div');
    div.className = 'message bot';
    div.id = id;
    div.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
    chatBox.appendChild(div);
    return id;
}

async function sendMessage(){
    const text = userInput.value.trim();
    if(!text) return;

    appendMessage(text,'user');
    userInput.value='';
    userInput.style.height='24px';

    const loader = appendLoading();

    try{
        const res = await fetch('/chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({message:text})
        });
        const data = await res.json();
        document.getElementById(loader).remove();
        appendMessage(data.response,'bot');
    }catch{
        document.getElementById(loader).remove();
        appendMessage('Server error.','bot');
    }
}

async function clearChat(){
    await fetch('/clear',{method:'POST'});
    chatBox.innerHTML='<div class="message bot">Chat cleared. Start again!</div>';
}
</script>

</body>
</html>
